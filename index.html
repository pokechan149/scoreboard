<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>LOL 실시간 전적보드</title>
    <style>
        body { background: transparent; color: white; font-family: 'Malgun Gothic', sans-serif; padding: 10px; margin: 0; }
        .dashboard { width: 350px; background: rgba(26, 26, 26, 0.95); border-radius: 15px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .title { font-size: 24px; font-weight: 900; color: #4da3ff; letter-spacing: -1px; }
        .total-badge { background: #222; padding: 5px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; color: #aaa; border: 1px solid #444; }
        
        /* 공통 플레이어 줄 스타일 */
        .player-row { display: flex; justify-content: space-between; align-items: center; background: #252525; margin-bottom: 8px; padding: 12px 15px; border-radius: 10px; }
        
        /* 위 두명 (파란색 포인트) */
        .blue-team { border-left: 4px solid #3498db; }
        /* 아래 두명 (빨간색 포인트) */
        .red-team { border-left: 4px solid #ff5e5e; }
        
        .player-name { font-size: 16px; font-weight: bold; color: #eee; }
        .score-box { font-size: 18px; font-weight: 800; }
        .win-val { color: #4da3ff; margin-right: 10px; }
        .loss-val { color: #ff5e5e; }
        #status { font-size: 10px; color: #555; text-align: right; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div class="title">버버솔</div>
            <div class="total-badge">총 <span id="total-wins" style="color:#4da3ff">0승</span></div>
        </div>
        <div id="player-list"></div>
        <div id="status">연결 중...</div>
    </div>

    <script>
        const API_KEY = "RGAPI-83625455-6ced-400b-8391-660ac830bb41";
        
        // nickname: 화면에 표시될 별명 / name: 실제 롤 닉네임
        const PLAYERS = [
            {nickname: "달묘", name: "달묘냥", tag: "냥냥펀치", team: "blue-team"},
            {nickname: "카푸", name: "브라움질리언왁싱", tag: "149", team: "blue-team"},
            {nickname: "몽나", name: "눅눅한 김말이", tag: "김밥천국", team: "red-team"},
            {nickname: "최또", name: "히히오쥼발싸", tag: "1030", team: "red-team"}
        ];

        let scoreData = {};
        PLAYERS.forEach(p => {
            scoreData[p.name] = { win: 0, loss: 0, checkedIds: new Set() };
        });

        const startTime = Date.now() - 3600000;

        async function updateScores() {
            try {
                let totalWinCount = 0;
                let html = "";

                for (let player of PLAYERS) {
                    const accRes = await fetch(`https://asia.api.riotgames.com/riot/account/v1/accounts/by-riot-id/${encodeURIComponent(player.name)}/${encodeURIComponent(player.tag)}?api_key=${API_KEY}`);
                    const accData = await accRes.json();
                    const puuid = accData.puuid;

                    const matchRes = await fetch(`https://asia.api.riotgames.com/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=5&api_key=${API_KEY}`);
                    const matchIds = await matchRes.json();

                    for (let mId of matchIds) {
                        if (scoreData[player.name].checkedIds.has(mId)) continue;

                        const detailRes = await fetch(`https://asia.api.riotgames.com/lol/match/v5/matches/${mId}?api_key=${API_KEY}`);
                        const mData = await detailRes.json();
                        
                        if (mData.info.gameEndTimestamp > startTime) {
                            const me = mData.info.participants.find(p => p.puuid === puuid);
                            if (me.win) scoreData[player.name].win++;
                            else scoreData[player.name].loss++;
                        }
                        scoreData[player.name].checkedIds.add(mId);
                    }

                    const pScore = scoreData[player.name];
                    totalWinCount += pScore.win;
                    
                    // team 변수에 따라 blue-team 또는 red-team 클래스가 적용됩니다.
                    html += `
                        <div class="player-row ${player.team}">
                            <div class="player-name">${player.nickname}</div>
                            <div class="score-box">
                                <span class="win-val">${pScore.win}승</span>
                                <span class="loss-val">${pScore.loss}패</span>
                            </div>
                        </div>`;
                }

                document.getElementById('player-list').innerHTML = html;
                document.getElementById('total-wins').innerText = totalWinCount + "승";
                document.getElementById('status').innerText = "최근 동기화: " + new Date().toLocaleTimeString();
            } catch (e) {
                console.error(e);
                document.getElementById('status').innerText = "오류 발생 (API 키 확인)";
            }
        }

        updateScores();
        setInterval(updateScores, 30000);
    </script>
</body>
</html>