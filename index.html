<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>LOL 실시간 전적</title>
    <style>
        body { 
            background: transparent; 
            color: white; 
            font-family: 'Malgun Gothic', sans-serif; 
            padding: 0; 
            margin: 0; 
            overflow: hidden; 
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh; /* 화면 높이에 꽉 차게 */
        }
        
        .dashboard { 
            width: 95vw; /* 화면 너비의 95% */
            background: rgba(15, 15, 15, 0.9); 
            border-radius: 1vw; 
            padding: 2vw; 
            box-shadow: 0 0.5vw 1.5vw rgba(0,0,0,0.5);
        }

        .player-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #222; 
            margin-bottom: 1.5vh; 
            padding: 1.5vh 4vw; 
            border-radius: 1vw; 
        }
        
        .blue-team { border-left: 0.8vw solid #3498db; }
        .red-team { border-left: 0.8vw solid #ff5e5e; }
        
        /* 글자 크기를 vw(화면 너비 비례) 단위로 설정 */
        .player-name { 
            font-size: 5.5vw; 
            font-weight: bold; 
            color: #ddd; 
            white-space: nowrap; 
        }
        
        .score-box { 
            font-size: 6vw; 
            font-weight: 800; 
        }
        
        .win-val { color: #4da3ff; margin-right: 2vw; }
        .loss-val { color: #ff5e5e; }
    </style>
</head>
<body>
    <div class="dashboard">
        <div id="player-list"></div>
    </div>

    <script>
        const API_KEY = "RGAPI-83625455-6ced-400b-8391-660ac830bb41";
        const PLAYERS = [
            {nickname: "달묘", name: "달묘냥", tag: "냥냥펀치", team: "blue-team"},
            {nickname: "카푸", name: "브라움질리언왁싱", tag: "149", team: "blue-team"},
            {nickname: "몽나", name: "눅눅한 김말이", tag: "김밥천국", team: "red-team"},
            {nickname: "최또", name: "히히오쥼발싸", tag: "1030", team: "red-team"}
        ];

        let scoreData = {};
        PLAYERS.forEach(p => {
            scoreData[p.name] = { win: 0, loss: 0, checkedIds: new Set() };
        });

        const now = new Date();
        const startTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 20, 0, 0).getTime();

        async function updateScores() {
            try {
                let html = "";
                for (let player of PLAYERS) {
                    const accRes = await fetch(`https://asia.api.riotgames.com/riot/account/v1/accounts/by-riot-id/${encodeURIComponent(player.name)}/${encodeURIComponent(player.tag)}?api_key=${API_KEY}`);
                    const accData = await accRes.json();
                    if (!accData.puuid) continue;
                    const puuid = accData.puuid;

                    const matchRes = await fetch(`https://asia.api.riotgames.com/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=5&api_key=${API_KEY}`);
                    const matchIds = await matchRes.json();

                    for (let mId of matchIds) {
                        if (scoreData[player.name].checkedIds.has(mId)) continue;
                        const detailRes = await fetch(`https://asia.api.riotgames.com/lol/match/v5/matches/${mId}?api_key=${API_KEY}`);
                        const mData = await detailRes.json();
                        if (mData.info.gameEndTimestamp > startTime) {
                            const me = mData.info.participants.find(p => p.puuid === puuid);
                            if (me.win) scoreData[player.name].win++;
                            else scoreData[player.name].loss++;
                        }
                        scoreData[player.name].checkedIds.add(mId);
                    }

                    const pScore = scoreData[player.name];
                    html += `
                        <div class="player-row ${player.team}">
                            <div class="player-name">${player.nickname}</div>
                            <div class="score-box">
                                <span class="win-val">${pScore.win}W</span>
                                <span class="loss-val">${pScore.loss}L</span>
                            </div>
                        </div>`;
                }
                document.getElementById('player-list').innerHTML = html;
            } catch (e) { console.error(e); }
        }

        updateScores();
        setInterval(updateScores, 30000);
    </script>
</body>
</html>
