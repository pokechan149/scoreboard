<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>LOL 실시간 전적</title>
    <style>
        body { 
            background: transparent; 
            color: white; 
            font-family: 'Malgun Gothic', sans-serif; 
            padding: 0; 
            margin: 0; 
            overflow: hidden; 
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
        }
        
        .dashboard { 
            /* 핵심: 정사각형 비율 고정 */
            width: 95vmin; 
            height: 95vmin; 
            background: rgba(15, 15, 15, 0.9); 
            border-radius: 2vmin; 
            padding: 2vmin; 
            box-shadow: 0 0.5vw 1.5vw rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* 위아래 간격을 균등하게 */
            box-sizing: border-box;
        }

        #player-list {
            display: flex;
            flex-direction: column;
            height: 85%; /* 상태창 제외 영역 확보 */
            justify-content: space-around; /* 플레이어 간 간격 균등 분배 */
        }

        .player-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #222; 
            padding: 2vmin 4vmin; 
            border-radius: 1.5vmin; 
            box-sizing: border-box;
        }
        
        .blue-team { border-left: 1vmin solid #3498db; }
        .red-team { border-left: 1vmin solid #ff5e5e; }
        
        .player-name { 
            font-size: 7vmin; /* 창 크기에 따라 글자 크기 최적화 */
            font-weight: bold; 
            color: #ddd; 
            white-space: nowrap; 
        }
        
        .score-box { 
            font-size: 8vmin; 
            font-weight: 800; 
        }
        
        .win-val { color: #4da3ff; margin-right: 2vmin; }
        .loss-val { color: #ff5e5e; }

        #status { 
            font-size: 3vmin; 
            color: #555; 
            text-align: right; 
            font-weight: bold;
            height: 5%;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div id="player-list">
            <div style="text-align:center; font-size:4vmin;">데이터 불러오는 중...</div>
        </div>
        <div id="status">Update: --:--:--</div>
    </div>

    <script>
        const API_KEY = "RGAPI-83625455-6ced-400b-8391-660ac830bb41";
        const PLAYERS = [
            {nickname: "달묘", name: "달묘냥", tag: "냥냥펀치", team: "blue-team"},
            {nickname: "카푸", name: "브라움질리언왁싱", tag: "149", team: "blue-team"},
            {nickname: "몽나", name: "눅눅한 김말이", tag: "김밥천국", team: "red-team"},
            {nickname: "최또", name: "히히오쥼발싸", tag: "1030", team: "red-team"}
        ];

        let scoreData = {};
        PLAYERS.forEach(p => { scoreData[p.name] = { win: 0, loss: 0, checkedIds: new Set() }; });

        const now = new Date();
        const startTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 20, 0, 0).getTime();
        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        async function updateScores() {
            try {
                let html = "";
                for (let player of PLAYERS) {
                    const accRes = await fetch(`https://asia.api.riotgames.com/riot/account/v1/accounts/by-riot-id/${encodeURIComponent(player.name)}/${encodeURIComponent(player.tag)}?api_key=${API_KEY}`);
                    if (accRes.status === 429) throw new Error("Rate Limit");
                    const accData = await accRes.json();
                    const puuid = accData.puuid;
                    await sleep(200);

                    const matchRes = await fetch(`https://asia.api.riotgames.com/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=5&api_key=${API_KEY}`);
                    const matchIds = await matchRes.json();
                    await sleep(200);

                    for (let mId of matchIds) {
                        if (scoreData[player.name].checkedIds.has(mId)) continue;
                        const detailRes = await fetch(`https://asia.api.riotgames.com/lol/match/v5/matches/${mId}?api_key=${API_KEY}`);
                        const mData = await detailRes.json();
                        if (mData.info && mData.info.gameEndTimestamp > startTime) {
                            const me = mData.info.participants.find(p => p.puuid === puuid);
                            if (me.win) scoreData[player.name].win++;
                            else scoreData[player.name].loss++;
                        }
                        scoreData[player.name].checkedIds.add(mId);
                        await sleep(200);
                    }

                    const pScore = scoreData[player.name];
                    html += `
                        <div class="player-row ${player.team}">
                            <div class="player-name">${player.nickname}</div>
                            <div class="score-box">
                                <span class="win-val">${pScore.win}W</span>
                                <span class="loss-val">${pScore.loss}L</span>
                            </div>
                        </div>`;
                }
                document.getElementById('player-list').innerHTML = html;
                const timeString = new Date().toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
                document.getElementById('status').innerText = "Update: " + timeString;
                document.getElementById('status').style.color = "#555";
            } catch (e) { 
                document.getElementById('status').innerText = e.message === "Rate Limit" ? "요청 지연 중..." : "API 오류";
                document.getElementById('status').style.color = "#ff5e5e";
            }
        }

        updateScores();
        setInterval(updateScores, 60000);
    </script>
</body>
</html>
